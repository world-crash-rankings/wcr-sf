{% extends 'base.html.twig' %}
{% import 'zone/_macros.html.twig' as macros %}

{% block title %}{{ title }} Videos - {{ parent() }}{% endblock %}

{% block body %}
<div class="row mt-4">
    <div class="col-12">
        <h1>Videos</h1>

        {# Navigation tabs #}
        <ul class="nav nav-tabs mb-4">
            {% for key, playlist in playlists %}
                <li class="nav-item">
                    <a class="nav-link{% if type == key %} active{% endif %}" href="{{ path('videos', {'type': key}) }}">
                        {{ playlist.title }}
                    </a>
                </li>
            {% endfor %}
        </ul>

        <div class="card">
            <div class="card-header bg-primary text-white text-center">
                <h2 class="mb-0">{{ title }}</h2>
                <p class="mb-0"><small>{{ info }}</small></p>
            </div>
            <div class="card-body p-0">
                {% if videos is empty %}
                    <p class="text-center text-muted p-4">No videos found.</p>
                {% else %}
                    <table class="table table-striped table-hover mb-0">
                        <tbody>
                            {% for video in videos %}
                                {{ macros.video_score_row(video.chartRank ?? '-', video, true) }}
                            {% endfor %}
                        </tbody>
                    </table>
                {% endif %}
            </div>
        </div>

        {# Statistics #}
        {% if videos is not empty %}
            <div class="text-center mt-4">
                <h3>Total: ${{ totalScore|number_format(0, '.', ',') }}</h3>
            </div>

            <div class="row mt-4">
                {# Players Count #}
                <div class="col-md-4">
                    <div class="card">
                        <div class="card-header bg-light text-center">
                            <h4 class="mb-0">Players Count</h4>
                        </div>
                        <div class="card-body p-0">
                            <table class="table table-sm table-striped mb-0">
                                <tbody>
                                    {% for item in playerCounts %}
                                        <tr>
                                            <td>
                                                <img src="{{ asset('img/flags/32/' ~ item.player.country.iso ~ '.png') }}" alt="{{ item.player.country.name }}" width="32" height="24" class="me-2">
                                                <a href="{{ path('player_view', {'nameUrl': item.player.nameUrl}) }}">{{ item.player.name }}</a>
                                            </td>
                                            <td class="text-end">{{ item.count }}</td>
                                        </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                {# Platforms Count #}
                <div class="col-md-4">
                    <div class="card">
                        <div class="card-header bg-light text-center">
                            <h4 class="mb-0">Platforms Count</h4>
                        </div>
                        <div class="card-body p-0">
                            <table class="table table-sm table-striped mb-0">
                                <tbody>
                                    {% for platform, count in platformCounts %}
                                        <tr>
                                            <td class="text-center">
                                                <img src="{{ asset('img/logos/' ~ platform|lower ~ '.png') }}" alt="{{ platform }}" width="48" height="48">
                                            </td>
                                            <td class="text-end">{{ count }}</td>
                                        </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                {# Freq Count #}
                <div class="col-md-4">
                    <div class="card">
                        <div class="card-header bg-light text-center">
                            <h4 class="mb-0">Freq Count</h4>
                        </div>
                        <div class="card-body p-0">
                            <table class="table table-sm table-striped mb-0">
                                <tbody>
                                    {% for freq, count in freqCounts %}
                                        <tr>
                                            <td class="text-center">
                                                <img src="{{ asset('img/logos/' ~ freq|lower ~ '_.png') }}" alt="{{ freq }}" width="48" height="48">
                                            </td>
                                            <td class="text-end">{{ count }}</td>
                                        </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        {% endif %}
    </div>
</div>
{% endblock %}
