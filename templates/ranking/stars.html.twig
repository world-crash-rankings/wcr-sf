{% extends 'base.html.twig' %}
{% import 'ranking/_ranking_macros.html.twig' as macros %}

{% block title %}Stars Ranking - {{ parent() }}{% endblock %}

{% block body %}
{% set current_ranking = 'stars' %}
{% include 'ranking/_ranking_header.html.twig' %}

<div class="row">
    <div class="col-12">
        <table class="table table-striped table-hover">
            <tbody>
                {% for player in players %}
                <tr>
                    {# Rank with medal for top 3 #}
                    <td class="text-center" style="width: 60px;">
                        {% if player.avgStarsRank <= 3 %}
                            <img src="{{ asset('img/medals/' ~ player.avgStarsRank ~ '.png') }}" alt="Rank {{ player.avgStarsRank }}" width="32" height="32">
                        {% else %}
                            <span class="h5">{{ player.avgStarsRank }}</span>
                        {% endif %}
                    </td>

                    {# Country flag #}
                    <td class="text-center" style="width: 60px;">
                        <img src="{{ asset('img/flags/32/' ~ player.country.iso ~ '.png') }}"
                             alt="{{ player.country.name }}"
                             title="{{ player.country.name }}"
                             width="32" height="24">
                    </td>

                    {# Player name (link) #}
                    <td>
                        {# TODO: Add link when PlayerController is created #}
                        <span class="text-primary">{{ player.name }}</span>
                    </td>

                    {# Stars visual display #}
                    <td class="text-center" style="width: 300px; white-space: nowrap;">
                        {% set fullStars = player.avgStars|number_format(1, '.', '')|round(0, 'floor') %}
                        {% for i in 1..10 %}
                            {% if i <= fullStars %}
                                <img src="{{ asset('img/stars/full.png') }}" alt="★" width="16" height="16">
                            {% else %}
                                <img src="{{ asset('img/stars/empty.png') }}" alt="☆" width="16" height="16">
                            {% endif %}
                        {% endfor %}
                    </td>

                    {# Numeric value #}
                    <td class="text-end" style="width: 80px;">
                        <strong>{{ player.avgStars }}</strong>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>

        <div class="mt-3">
            {{ form_start(form) }}
                <div class="row align-items-end">
                    <div class="col-auto">
                        {{ form_row(form.limit) }}
                    </div>
                    <div class="col-auto">
                        {{ form_row(form.submit) }}
                    </div>
                </div>
            {{ form_end(form) }}
        </div>
    </div>
</div>
{% endblock %}
