{% extends 'base.html.twig' %}
{% import 'zone/_zone_header.html.twig' as zone_header %}
{% import 'zone/_macros.html.twig' as macros %}

{% block title %}{{ zone.name }} - Strats - World Crash Rankings{% endblock %}

{% block body %}
{{ zone_header.header(zone, 'strats') }}

<h1>Strats</h1>

{% for strat in strats %}
<section class="card mb-3">
    <div class="card-header">
        <div class="row text-center align-items-center">
            <div class="col-md-3">
                {# Platform icons #}
                {% if strat.xbox %}
                    <img src="{{ asset('img/logos/xbox.png') }}" alt="Xbox" width="32" height="32" class="me-1">
                {% endif %}
                {% if strat.gc %}
                    <img src="{{ asset('img/logos/gc.png') }}" alt="GameCube" width="32" height="32" class="me-1">
                {% endif %}
                {% if strat.ps2 %}
                    <img src="{{ asset('img/logos/ps2.png') }}" alt="PS2" width="32" height="32" class="me-1">
                {% endif %}
                {# Frequency badges #}
                {% if strat.hz50 %}
                    <img src="{{ asset('img/logos/50hz_.png') }}" alt="50Hz" width="32" height="32" class="me-1">
                {% endif %}
                {% if strat.hz60 %}
                    <img src="{{ asset('img/logos/60hz_.png') }}" alt="60Hz" width="32" height="32">
                {% endif %}
            </div>
            <div class="col-md-6">
                <h1>{{ strat.name }}</h1>
            </div>
            <div class="col-md-3">
                {# Car images #}
                {% for car in strat.cars %}
                    <img src="{{ asset('img/cars/' ~ car.name|car_image ~ '.png') }}" alt="{{ car.name }}" height="32" title="{{ car.name }}">
                {% endfor %}
            </div>
        </div>
    </div>
    <article class="card-body">
        {# Description #}
        <div class="mb-3 rich-content">
            {{ strat.description|raw }}
        </div>

        {# Best Damage/Multi/Total #}
        <div class="row">
            <div class="col-md-6 offset-md-3">
                <table class="table table-sm mb-0">
                    <thead>
                        <tr>
                            <th class="text-center">Best Damage</th>
                            <th></th>
                            <th class="text-center">Best Multi</th>
                            <th></th>
                            <th class="text-center">Best Total</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td class="text-center">{{ strat.bestDamage|number_format(0, '.', ',') }}</td>
                            <td class="text-center">x</td>
                            <td class="text-center">{{ strat.bestMulti|number_format(0, '.', ',') }}</td>
                            <td class="text-center">=</td>
                            <td class="text-center">{{ strat.bestTotal|number_format(0, '.', ',') }}</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        {# Top 10 Scores - Collapsible #}
        <div class="mt-3">
            <h4 class="text-primary">
                <a href="#strat-{{ strat.id }}-scores" data-bs-toggle="collapse" role="button" aria-expanded="false" class="text-decoration-none">
                    Top10 Scores â–²
                </a>
            </h4>
            <div class="collapse" id="strat-{{ strat.id }}-scores">
                <table class="table table-hover table-sm">
                    <tbody>
                        {% set sorted_scores = strat.scores|sort((a, b) => b.score <=> a.score)|slice(0, 10) %}
                        {% for score in sorted_scores %}
                            {{ macros.score_row(score.chartRank ?? '-', score, false) }}
                        {% else %}
                        <tr>
                            <td colspan="11" class="text-center">No scores for this strat</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </article>
</section>
{% endfor %}
{% endblock %}
